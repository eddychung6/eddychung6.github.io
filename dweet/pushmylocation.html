

 <!DOCTYPE html>
<html>
<head>
<script src="//dweet.io/client/dweet.io.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v1.11.1/mapbox-gl.css' rel='stylesheet' />
<style>
	#map{
		display:none;
	}
</style>
</head>
<body>
<button id="btnDweet">start</button>
<button id="btnDweetStop">stop</button>
<div id='map' style='width: 500px; height: 400px;'></div>
</body>
<script>
$( document ).ready(function() {
	var watcherID = 0;
    $("#btnDweet").click(function(){
		//console.log("btn click");
		//var JSON = {"content1":$("#textJSON").val()};
		//todweet(JSON);
		//setInterval(theGetLocation, 10000);
		/* mapboxgl.accessToken = 'pk.eyJ1IjoiZWRkeWNodW5nIiwiYSI6ImNrZDg3YXptYjA2dHQycnAyaXg0Y2cxY2MifQ.QqgFaTvEVw_obXSHrzDfIw';
		var ll = new mapboxgl.LngLat(dweet.content.Longitude,dweet.content.Latitude);
		map = new mapboxgl.Map({
			container: 'map',
			style: 'mapbox://styles/mapbox/streets-v11', // stylesheet location
			center: [ll.lng, ll.lat], // starting position [lng, lat]
			zoom: 15, // starting zoom
		}); */
		//$("#map").css('display', 'block');
		theGetLocation();
	});
	$("#btnDweetStop").click(function(){
		/* console.log("got watcher ID:");
		console.log(watcherID); */
		//theGetLocation();
		navigator.geolocation.clearWatch(watcherID);
	});
	
	
	const todweet = (msgJSON) => {
		dweetio.dweet_for("NbMHpe", msgJSON, function(err, dweet){
		/* console.log("dweet updated resule:")
		console.log(dweet);
		console.log("----------"); */


		//console.log(dweet.thing); // "my-thing"
		//console.log(dweet.content); // The content of the dweet
		//console.log(dweet.created); // The create date of the dweet

		});
	};
	
	var theGetLocation = function getLocation() {
		if (navigator.geolocation) {
			function success(position) {
				//console.log("Got the update GEO information...");
				updatePosition(position.coords.latitude, position.coords.longitude);
			}
			function error() {
				alert('Sorry, no position available.');
			}
			//first time to get the location 
			navigator.geolocation.getCurrentPosition(showPosition);
			function showPosition(position) {
				mapboxgl.accessToken = 'pk.eyJ1IjoiZWRkeWNodW5nIiwiYSI6ImNrZDg3YXptYjA2dHQycnAyaXg0Y2cxY2MifQ.QqgFaTvEVw_obXSHrzDfIw';
				var ll = new mapboxgl.LngLat(position.coords.longitude,position.coords.latitude);
				map = new mapboxgl.Map({
					container: 'map',
					style: 'mapbox://styles/mapbox/streets-v11', // stylesheet location
					center: [ll.lng, ll.lat], // starting position [lng, lat]
					zoom: 12, // starting zoom
				});
				console.log("map created");
				console.log(map);
				//$("#map").css('display', 'block');
			}
			//for watchPosition
			const options = {
			  enableHighAccuracy: true, 
			  maximumAge: 30000, 
			  timeout: 30000
			};
			const watchID = navigator.geolocation.watchPosition(success, error, options);
			console.log("watchID No:"+watchID);
			//return the watchID for stopping
			watcherID = watchID;
		} else { 
			alert("Geolocation is not supported by this browser.");
			//x.innerHTML = "Geolocation is not supported by this browser.";
		}
	}
	
	function updatePosition(latitude,longitude) {
		
		var geo = {
			"Latitude":latitude,
			"Longitude":longitude,
		};
		//console.log("Dweet to update")
		//console.log(geo);	
		//update dweet
		//var JsonGeoData = JSON.stringify(geo);
		//console.log(JsonGeoData);
		todweet(geo);
	}

});
	dweetio.listen_for("NbMHpe", function(dweet){
		console.log("news:"); 
		//console.log(dweet);
	});	

</script>
</html> 